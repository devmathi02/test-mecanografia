<title>Prueba de Mecanografía ⌨️</title>
<style>
    :root{
        color-scheme: light dark;
        --green: #08b755;
        --yellow: #daaf38;
        --red: #ca4754;
        --black: #222;
        --gray: #999;
    }

    body{
        background: var(--black);
        font-family: Melon, monospace;
        display: grid;
        padding: 32px;
        justify-content: center;
        margin-top: 32px;
        padding: 16px;
    }

    section{
        padding: 16px;
        display: flex;
        flex-direction: column;
        gap: 4px;
        max-width: 500px;
    }

    time{
        color: var(--yellow);
    }

    input{
        z-index: -999;
        position: absolute;
        top: 0;
        left: 0;
        pointer-events: none;
        /*opacity: 0;*/
    }

    p{
        display: flex;
        flex-wrap: wrap;
        gap: 3px 8px;
        margin: 0;
    }

    x-letter{
        color: var(--gray);
        position: relative;

        &.active::before{
            content: '|';
            color: var(--yellow);
            font-size: 14px;
            position: absolute;
            left: -65%;
            animation: 1s blink infinite ease-in-out;
        }

        &.active.is-last::before{
            left: 65%;
        }

        &.correct {
            color: var(--green);
        }

        &.incorrect {
            color: var(--red);
        }
    }

    @keyframes blink {
        0%, 25%{
            opacity: 1;
        }

        75%{
            opacity: 0;
        }
    }
</style>

<body>
    <main>
        <section id="game">
            <time></time>
            <p></p>
            <input autofocus>
        </section>
    </main>
</body>

<script>
    const $time = document.querySelector('time')
    const $paragraph = document.querySelector('p')
    const $input = document.querySelector('input')

    const INITIAL_TIME = 30

    const TEXT = 'El viento soplaba con fuerza sobre la montaña mientras la luna iluminaba el camino. Las personas caminaban tranquilas, disfrutando del aire fresco de la noche.'

    let words = []
    let currentTime = INITIAL_TIME

    initGame();
    initEvents();

    function initGame() {
        words = TEXT.split(' ').slice(0, 32);
        currentTime = INITIAL_TIME

        $time.textContent = currentTime

        $paragraph.innerHTML = words.map((word, index) => {
            const letters = word.split('');

            return  `<x-word>
                ${letters
                    .map(letter => `<x-letter>${letter}</x-letter>`)
                    .join('')
                }
                </x-word>`
        }).join('')

        const $fristWord = $paragraph.querySelector('x-word')
        $fristWord.classList.add('active')
        $fristWord.querySelector('x-letter').classList.add('active')

        const intervalId = setInterval(() => {
            currentTime--
            $time.textContent = currentTime

            if (currentTime === 0) {
                clearInterval(intervalId)
                gameOver()
            }
        }, 1000)
    }
    function initEvents() {
        document.addEventListener('keydown', () => {
            $input.focus()
        })
        $input.addEventListener('keydown', onkeydown) //teclas especiales como espacio o retroceso
        $input.addEventListener('keyup', onkeyup) //cuando el usuario suelta la tecla
    }

    function onkeydown(event) {
        const { key } = event
        console.log({ key }) //aca te quedaste 25/03/2025
    }

    function onkeyup() {
        //recuperamos los elementos actuales
        const $currentWord = $paragraph.querySelector('x-word.active')
        const $currentLetter = $currentWord.querySelector('x-letter.active')

        const currentWord = $currentWord.innerText.trim()
        $input.maxLength = currentWord.length
        console.log({ value: $input.value, currentWord })

        const $allLetters = $currentWord.querySelectorAll('x-letter')

        $allLetters.forEach($letter => $letter.classList.remove('correct', 'incorrect'))

        $input.value.split('').forEach((char, index) => {
            const $letter = $allLetters[index]
            const letterToCheck = currentWord[index]

            const isCorrect = char === letterToCheck
            const letterClass = isCorrect ? 'correct' : 'incorrect'
            $letter.classList.add(letterClass)
        })

        $currentLetter.classList.remove('active', 'is-last')
        const inputLength = $input.value.length
        const $nextActiveLetter = $allLetters[inputLength]

        if($nextActiveLetter){
            $nextActiveLetter.classList.add('active')
        } else {
            $currentLetter.classList.add('active', 'is-last')
            // TODO: gameover si no hay próxima palabra.
        }
    }

    function gameOver() {
        console.log('game over')
    }
</script>